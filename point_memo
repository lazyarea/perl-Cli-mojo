CREATE TABLE plg_point
(
    plg_point_id INTEGER PRIMARY KEY NOT NULL,
    order_id INTEGER,
    customer_id INTEGER NOT NULL,
    plg_point_info_id INTEGER NOT NULL,
    plg_point_product_rate_id INTEGER,
    plg_dynamic_point INTEGER NOT NULL,
    plg_point_type SMALLINT NOT NULL,
    plg_point_action_name VARCHAR(255) DEFAULT NULL::character varying,
    create_date TIMESTAMP(0) NOT NULL,
    update_date TIMESTAMP(0) NOT NULL,
    plg_point_customer_id INTEGER,
    dtb_point_status_id INTEGER,
    CONSTRAINT plg_point_plg_point_info_id_fkey FOREIGN KEY (plg_point_info_id)
REFERENCES plg_point_info (plg_point_info_id),
    CONSTRAINT plg_point_plg_point_product_rate_id_fkey FOREIGN KEY
(plg_point_product_rate_id) REFERENCES plg_point_product_rate
(plg_point_product_rate_id)
);
CREATE INDEX idx_53a0aeff8d9f6d38 ON plg_point (order_id);
CREATE INDEX idx_53a0aeff9395c3f3 ON plg_point (customer_id);
CREATE INDEX idx_53a0aeff7eb32aa5 ON plg_point (plg_point_info_id);
CREATE INDEX idx_53a0aeffcc8c40c1 ON plg_point (plg_point_product_rate_id);
CREATE INDEX plg_point_customer_idx_949475ab9395c3f3 ON plg_point
(plg_point_customer_id);

CREATE TABLE plg_point_customer
(
    plg_point_customer_id INTEGER PRIMARY KEY NOT NULL,
    customer_id INTEGER NOT NULL,
    plg_point_current INTEGER NOT NULL,
    create_date TIMESTAMP(0) NOT NULL,
    update_date TIMESTAMP(0) NOT NULL
);
CREATE INDEX idx_94c09bab9395c3f3 ON plg_point_customer (customer_id);

CREATE TABLE plg_point_snapshot
(
    plg_point_snapshot_id INTEGER NOT NULL,
    order_id INTEGER,
    customer_id INTEGER,
    client_code VARCHAR(7) DEFAULT NULL::character varying,
    plg_point_use INTEGER,
    plg_point_current INTEGER NOT NULL,
    plg_point_add VARCHAR(255) DEFAULT NULL::character varying,
    plg_point_snap_action_name VARCHAR(255) DEFAULT NULL::character varying,
    create_date TIMESTAMP(0) NOT NULL,
    update_date TIMESTAMP(0) NOT NULL,
    plg_point_before INTEGER,
    plg_point_memo TEXT,
    order_date VARCHAR,
    uri_date VARCHAR,
    point_allocation INTEGER,
    seq_history INTEGER,
    plg_point_customer_id INTEGER,
    rrr_order_no TEXT,
    craft_number VARCHAR(6)
);
COMMENT ON COLUMN plg_point_snapshot.plg_point_before IS '変更前ポイント数';
COMMENT ON COLUMN plg_point_snapshot.order_date IS '受注伝票日付';
COMMENT ON COLUMN plg_point_snapshot.uri_date IS '売上伝票日付';
COMMENT ON COLUMN plg_point_snapshot.point_allocation IS '引当可能ポイント数';
COMMENT ON COLUMN plg_point_snapshot.seq_history IS
'連番の降順でECは履歴を表示（会員制）';
CREATE INDEX idx_39b400978d9f6d38 ON plg_point_snapshot (order_id);
CREATE INDEX idx_39b400979395c3f3 ON plg_point_snapshot (customer_id);
CREATE INDEX idx_39b4009795f5c3f3 ON plg_point_snapshot (client_code);

CREATE TABLE plg_point_status
(
    point_status_id INTEGER PRIMARY KEY NOT NULL,
    customer_id INTEGER NOT NULL,
    status SMALLINT DEFAULT 0 NOT NULL,
    del_flg SMALLINT DEFAULT 0 NOT NULL,
    point_fix_date TIMESTAMP(0) DEFAULT NULL::timestamp without time zone,
    plg_point_customer_id INTEGER,
    order_id INTEGER,
    point_expire_date TIMESTAMP(0) DEFAULT NULL::timestamp without time zone
);
CREATE INDEX idx_94c09bab9787c3f3 ON plg_point_status (plg_point_customer_id);

